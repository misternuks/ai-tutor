<div class="p-3 m-3 d-flex flex-column align-items-center justify-content-center">
  <div class="display-card">
    <% if @user.admin %>
      <h3 class="text-center m-0">All chat logs for all users</h3>
      <% @chatrooms.order(:user_id).each do |chatroom| %>
        <div class="card m-3 p-3">
          <h5>
            <%= chatroom.user.username %> (<%= chatroom.user.email %>)
          </h5>
          <% chatroom.messages.order(:chatroom_id).each do |message| %>
            <div class="card m-1 p-1">
              <strong>
                <%= message.chatroom.lesson.unit.course.name %> | <%= message.chatroom.lesson.unit.name %> | <%= message.chatroom.lesson.name %><br>
              </strong>
              <%= message.created_at %><br>
              <%= message.user.username %>: <%= message.content %>
            </div>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <h3 class="text-center m-0">Your chats for <%= @lesson.name %></h3>
      <div class="d-flex justify-content-center align-items-center">
      </div>
      <hr>
      <div class="d-flex flex-column justify-content-center align-items-center gap-1">
        <% @lesson.chatrooms.order(:created_at).reverse.each do |chatroom| %>
          <% if @user.chatrooms.include? chatroom %>
            <div class="d-flex align-self-stretch align-items-center justify-content-start">
              <%= link_to chatroom.name, chatroom_path(chatroom), class: "btn btn-gradient w-100 mb-1" %>
              <%= link_to chatroom_path(chatroom),
            class: "btn",
            data: { "turbo-method": :delete,
            turbo_confirm: "Are you sure you want to delete this chat?" } do %>
                <i class="fa-solid fa-trash-can text-secondary"></i>
              <% end %>
            </div>
          <% end %>
        <% end %>
        <%= link_to "+ Make a new chat",
        new_lesson_chatroom_path(@lesson),
        class: "btn btn-ghost w-100 mt-3" %>
      </div>
    <% end %>
  </div>
</div>
<div class="d-flex align-items-center justify-content-center ">
  <%= link_to "< Back to courses", courses_path, class: "btn btn-ghost-2 h1" %>
</div>
